{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/abun/projects/web-apps/nanobanana-to-pptx/app/api/preview/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport fs from 'fs'\nimport path from 'path'\n\nexport async function GET(request: NextRequest) {\n  const sessionId = request.nextUrl.searchParams.get('sessionId')\n\n  if (!sessionId) {\n    return NextResponse.json({ error: 'sessionId is required' }, { status: 400 })\n  }\n\n  const projectRoot = process.cwd()\n  const outputDir = path.join(projectRoot, 'agent_output', sessionId)\n\n  if (!fs.existsSync(outputDir)) {\n    return NextResponse.json({ error: 'Session not found' }, { status: 404 })\n  }\n\n  // プレビュー画像を探す\n  let previewUrl: string | null = null\n  const possibleBackgrounds = ['background_v2.png', 'background.png', 'Slide1.jpg']\n\n  for (const filename of possibleBackgrounds) {\n    const filePath = path.join(outputDir, filename)\n    if (fs.existsSync(filePath)) {\n      const imageData = fs.readFileSync(filePath)\n      const base64 = imageData.toString('base64')\n      const ext = path.extname(filename).slice(1)\n      const mimeType = ext === 'jpg' ? 'jpeg' : ext\n      previewUrl = `data:image/${mimeType};base64,${base64}`\n      break\n    }\n  }\n\n  // design.jsonから要素を取得\n  interface DesignElement {\n    type: string\n    id?: string\n    content?: string\n    position?: { x: number; y: number; width: number; height: number }\n    style?: {\n      fontSize?: number\n      fontWeight?: string\n      color?: string\n      align?: string\n    }\n  }\n\n  interface DesignJson {\n    elements?: DesignElement[]\n  }\n\n  let elements: DesignElement[] = []\n  const designPath = path.join(outputDir, 'design.json')\n  if (fs.existsSync(designPath)) {\n    try {\n      const designJson = JSON.parse(fs.readFileSync(designPath, 'utf-8')) as DesignJson\n      elements = (designJson.elements || []).map((elem: DesignElement, index: number) => ({\n        id: elem.id || `${elem.type}_${index}`,\n        type: elem.type,\n        content: elem.content,\n        position: elem.position,\n        style: elem.style,\n      }))\n    } catch {\n      // JSONパースに失敗した場合は空の配列\n    }\n  }\n\n  return NextResponse.json({\n    previewUrl,\n    elements,\n    sessionId,\n  })\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,MAAM,YAAY,QAAQ,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;IAEnD,IAAI,CAAC,WAAW;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;IAEA,MAAM,cAAc,QAAQ,GAAG;IAC/B,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,aAAa,gBAAgB;IAEzD,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,YAAY;QAC7B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;IACzE;IAEA,aAAa;IACb,IAAI,aAA4B;IAChC,MAAM,sBAAsB;QAAC;QAAqB;QAAkB;KAAa;IAEjF,KAAK,MAAM,YAAY,oBAAqB;QAC1C,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,WAAW;QACtC,IAAI,wGAAE,CAAC,UAAU,CAAC,WAAW;YAC3B,MAAM,YAAY,wGAAE,CAAC,YAAY,CAAC;YAClC,MAAM,SAAS,UAAU,QAAQ,CAAC;YAClC,MAAM,MAAM,4GAAI,CAAC,OAAO,CAAC,UAAU,KAAK,CAAC;YACzC,MAAM,WAAW,QAAQ,QAAQ,SAAS;YAC1C,aAAa,CAAC,WAAW,EAAE,SAAS,QAAQ,EAAE,QAAQ;YACtD;QACF;IACF;IAoBA,IAAI,WAA4B,EAAE;IAClC,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,WAAW;IACxC,IAAI,wGAAE,CAAC,UAAU,CAAC,aAAa;QAC7B,IAAI;YACF,MAAM,aAAa,KAAK,KAAK,CAAC,wGAAE,CAAC,YAAY,CAAC,YAAY;YAC1D,WAAW,CAAC,WAAW,QAAQ,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC,MAAqB,QAAkB,CAAC;oBAClF,IAAI,KAAK,EAAE,IAAI,GAAG,KAAK,IAAI,CAAC,CAAC,EAAE,OAAO;oBACtC,MAAM,KAAK,IAAI;oBACf,SAAS,KAAK,OAAO;oBACrB,UAAU,KAAK,QAAQ;oBACvB,OAAO,KAAK,KAAK;gBACnB,CAAC;QACH,EAAE,OAAM;QACN,sBAAsB;QACxB;IACF;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QACvB;QACA;QACA;IACF;AACF"}}]
}